<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ูุฐููุฑ ุงููุฑุฏ ุงููููู - Wird Reminder</title>
    <meta name="description"
        content="ุฅุถุงูุฉ ูุฌุงููุฉ ูููุชุตูุญ ุชุณุงุนุฏู ุนูู ุงููุญุงูุธุฉ ุนูู ูุฑุฏ ุงููุฑุขู ุงููุฑูู ููููุงู ุจุชุฐููุฑุงุช ุฐููุฉ ููุงุฑุฆ ูุตุญู ุฌููู.">

    <!-- Same fonts as the extension -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Tajawal:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Base Styles (React/Tailwind) are handled by main.tsx -->
    <!-- Legacy Styles (App only) -->
    <link rel="stylesheet" href="styles.css" id="legacy-styles" disabled>
    <link rel="stylesheet" href="core/css/theme-toggle.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="core/assets/icons/icon48.png">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <link rel="apple-touch-icon" href="core/assets/icons/icon128.png">

    <style>
        /* Conditional Visibility */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body.is-app {
            overflow: hidden;
        }

        /* If we are in mobile/capacitor, we hide the React root */
        body.is-app #root {
            display: none !important;
        }

        /* If we are NOT in mobile, we hide the app container by default (React manages landing) */
        body:not(.is-app) #app-container, 
        body:not(.is-app) #reader-view {
            display: none !important;
        }

        #root {
            width: 100%;
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <!-- 1. React Landing Page Mount Point -->
    <div id="root"></div>

    <!-- 2. Extension App Container (Standalone / Android / Extension) -->
    <div class="app-container" id="app-container">
        <!-- Header -->
        <header>
            <div class="logo-area">
                <img src="core/assets/icons/icon48.png" alt="Wird Logo">
                <h1>ููุฐูููุฑ ุงูููุฑุฏ ุงููููู</h1>
            </div>
            <div id="theme-toggle-container" class="theme-toggle-container"></div>
        </header>

    
        <!-- Content -->
        <main class="content">
            <!-- Tab: Reminders -->
            <section id="reminders-tab" class="tab-content active">
                <h2 class="section-title">ูุงุฆูุชู</h2>
                <div id="my-reminders-list">
                    <!-- Populated by JS -->
                </div>

                <div class="divider"></div>

                <h2 class="section-title">ุชุฐููุฑุงุช ุงูุณูู</h2>
                <div id="presets-list">
                    <!-- Populated by JS -->
                </div>
            </section>

            <!-- Tab: Add New -->
            <section id="add-new" class="tab-content">
                <form id="add-reminder-form">
                    <input type="hidden" id="edit-id" value="">

                    <div class="form-item">
                        <label class="label">ููุน ุงูุชุฐููุฑ</label>
                        <select id="reminder-type" class="input">
                            <option value="surah">ุณูุฑุฉ ูุงููุฉ</option>
                            <option value="ayah_range">ุขูุงุช ูุญุฏุฏุฉ</option>
                            <option value="juz">ุฌุฒุก ูู ุงููุฑุขู</option>
                        </select>
                    </div>

                    <div class="form-item">
                        <label class="label">ุงุฎุชุฑ ุงููุฏู</label>
                        <select id="target-select" class="input">
                            <option value="" disabled selected>ุฌุงุฑู ุงูุชุญููู...</option>
                        </select>
                    </div>

                    <div id="ayah-range-group" style="display:none;" class="form-item">
                        <div style="display: flex; gap: 0.5rem;">
                            <div style="flex: 1;">
                                <label class="label" style="font-size: 0.7rem;">ูู ุขูุฉ</label>
                                <input type="number" id="start-ayah" class="input" placeholder="1" min="1">
                            </div>
                            <div style="flex: 1;">
                                <label class="label" style="font-size: 0.7rem;">ุฅูู ุขูุฉ</label>
                                <input type="number" id="end-ayah" class="input" placeholder="5" min="1">
                            </div>
                        </div>
                    </div>

                    <div class="form-item">
                        <label class="label">ุงุณู ุงูุชุฐููุฑ</label>
                        <input type="text" id="reminder-name" placeholder="ูุซุงู: ูุฑุฏ ุงููุฌุฑ" class="input">
                    </div>

                    <div style="display: flex; gap: 0.75rem;" class="form-item">
                        <div style="flex: 1.5;">
                            <label class="label">ุงูุชูุฑุงุฑ</label>
                            <select id="frequency" class="input">
                                <option value="daily">ููููุงู</option>
                                <option value="weekly">ุฃุณุจูุนูุงู</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label class="label">ุงูููุช</label>
                            <input type="time" id="time-select" class="input" value="08:00">
                        </div>
                    </div>

                    <div class="form-item" id="day-select-group" style="display:none;">
                        <label class="label">ุงูููู</label>
                        <select id="day-select" class="input">
                            <option value="5">ุงูุฌูุนุฉ</option>
                            <option value="6">ุงูุณุจุช</option>
                            <option value="0">ุงูุฃุญุฏ</option>
                            <option value="1">ุงูุงุซููู</option>
                            <option value="2">ุงูุซูุงุซุงุก</option>
                            <option value="3">ุงูุฃุฑุจุนุงุก</option>
                            <option value="4">ุงูุฎููุณ</option>
                        </select>
                    </div>

                    <div class="submit-area">
                        <button type="submit" id="submit-btn" class="btn btn-primary btn-xl">ุญูุธ
                            ุงูุชุฐููุฑ</button>
                        <button type="button" id="cancel-edit-btn" class="btn btn-outline btn-xl"
                            style="display:none; margin-top:0.5rem;">ุฅูุบุงุก ุงูุชุนุฏูู</button>
                    </div>
                </form>
            </section>

            <!-- Tab: Settings -->
            <section id="settings-tab" class="tab-content">
                <h2 class="section-title">ุงููุณุฎ ุงูุงุญุชูุงุทู</h2>
                <div class="settings-group">
                    <p class="settings-description">ููููู ุชุตุฏูุฑ ุจูุงูุงุชู ูุญูุธูุง ุฃู ููููุง ุฅูู ุฌูุงุฒ ุขุฎุฑ.</p>
                    <button id="export-data" class="btn btn-primary btn-xl">
                        ๐ค ุชุตุฏูุฑ ุงูุจูุงูุงุช
                    </button>
                    <button id="import-data" class="btn btn-outline btn-xl">
                        ๐ฅ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
                    </button>
                    <input type="file" id="import-file-input" accept=".json" style="display:none;">
                </div>

                <div class="divider"></div>

                <h2 class="section-title">ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h2>
                <div class="settings-group">
                    <p class="settings-description">ุญุฐู ุณุฌู ุงูุฅูุฌุงุฒ ููุท ูุน ุงูุงุญุชูุงุธ ุจุงูุชุฐููุฑุงุช.</p>
                    <button id="clear-history" class="btn btn-outline btn-xl">
                        ๐๏ธ ูุณุญ ุณุฌู ุงูุฅูุฌุงุฒ
                    </button>
                </div>

                <div class="divider"></div>

                <h2 class="section-title" style="color: hsl(var(--destructive));">ููุทูุฉ ุงูุฎุทุฑ</h2>
                <div class="settings-group danger-zone">
                    <p class="settings-description">ุฅุนุงุฏุฉ ุถุจุท ุงูุฅุถุงูุฉ ุจุงููุงูู ูุญุฐู ุฌููุน ุงูุจูุงูุงุช.</p>
                    <button id="reset-extension" class="btn btn-xl"
                        style="background-color: hsl(var(--destructive)); color: white;">
                        โ๏ธ ุฅุนุงุฏุฉ ุถุจุท ุงูุฅุถุงูุฉ
                    </button>
                </div>
            </section>

            <!-- Tab: Downloads (PWA specific) -->
            <section id="downloads-tab" class="tab-content">
                <h2 class="section-title">ุญููู ุงูุฅุถุงูุฉ ูุงูุชุทุจูู</h2>
                <p class="settings-description">ุงุญุตู ุนูู ุงูุชุฌุฑุจุฉ ุงููุงููุฉ ูุน ุงูุฅุดุนุงุฑุงุช ุงููุฌุฏููุฉ ุนูู ุฌููุน ุฃุฌูุฒุชู.</p>

                <div class="downloads-list"
                    style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                    <a href="https://chromewebstore.google.com/detail/%D8%A7%D9%84%D9%88%D8%B1%D8%AF-%D8%A7%D9%84%D9%8A%D9%88%D9%85%D9%8A/pgogfohfgohkfpfifdojhmladlaeceok"
                        target="_blank" class="download-btn-mini">
                        <span class="browser-icon">๐</span>
                        <div class="download-text">
                            <span class="browser-name">Chrome Extension</span>
                            <span class="browser-desc">ุฅุถุงูุฉ ูุชุตูุญ ูุฑูู</span>
                        </div>
                    </a>
                    <a href="https://addons.mozilla.org/en-US/firefox/addon/%D8%A7%D9%84%D9%88%D8%B1%D8%AF-%D8%A7%D9%84%D9%8A%D9%88%D9%85%D9%8A/"
                        target="_blank" class="download-btn-mini">
                        <span class="browser-icon">๐ฆ</span>
                        <div class="download-text">
                            <span class="browser-name">Firefox Add-on</span>
                            <span class="browser-desc">ุฅุถุงูุฉ ูุชุตูุญ ูุงูุฑูููุณ</span>
                        </div>
                    </a>
                </div>
            </section>
        </main>
        <!-- Bottom Navigation Bar -->
        <div class="tabs-nav bottom-tabs">
            <button class="tab-trigger active" data-tab="reminders-tab">
                <i class="bi bi-card-checklist"></i>
                <span>ุงูุชุฐููุฑุงุช</span>
            </button>
            <button class="tab-trigger" data-tab="add-new">
                <i id="add-new-icon" class="bi bi-plus-circle"></i>
                <i id="edit-new-icon" class="bi bi-pencil-square" style="display: none;"></i>
                <span id="add-new-btn">ุฅุถุงูุฉ</span>
            </button>
            <button class="tab-trigger" data-tab="settings-tab">
                <i class="bi bi-gear-wide-connected"></i>
                <span>ุงูุฅุนุฏุงุฏุงุช</span>
            </button>
            <button class="tab-trigger" id="pwa-downloads-trigger" data-tab="downloads-tab" style="display: none;">
                <i class="bi bi-cloud-arrow-down"></i>
                <span>ุงูุชุญููู</span>
            </button>
        </div>

    </div>

    <!-- Reader View (Hidden by default) -->
    <div class="reader-view" id="reader-view" style="display:none;">
        <div class="reader-header">
            <button class="back-btn" id="back-btn">โ ุงูุนูุฏุฉ</button>
            <span id="reader-title">ุณูุฑุฉ ุงููุงุชุญุฉ</span>
        </div>
        <div class="reader-content" id="reader-content">
            <!-- Verses rendered here -->
        </div>
        <div class="reader-footer">
            <button class="btn btn-primary btn-xl" id="mark-read-btn">โ ุชุญุฏูุฏ ูููุฑูุก</button>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendar-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content calendar-modal">
            <div class="calendar-header">
                <button id="calendar-prev" class="btn btn-ghost calendar-nav">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <h3 id="calendar-title" class="modal-title"></h3>
                <button id="calendar-next" class="btn btn-ghost calendar-nav">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
            </div>
            <div id="calendar-reminder-name" class="calendar-reminder-name"></div>
            <div class="calendar-weekdays">
                <span>ุฃุญุฏ</span>
                <span>ุงุซู</span>
                <span>ุซูุซ</span>
                <span>ุฃุฑุจุน</span>
                <span>ุฎูุณ</span>
                <span>ุฌูุน</span>
                <span>ุณุจุช</span>
            </div>
            <div id="calendar-grid" class="calendar-grid"></div>
            <div class="calendar-legend">
                <div class="legend-item">
                    <span class="legend-icon completed">โ</span>
                    <span>ูููุฌุฒ</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon missed"></span>
                    <span>ุบูุฑ ูููุฌุฒ</span>
                </div>
            </div>
            <div class="modal-footer">
                <button id="calendar-close" class="btn btn-primary btn-xl">ุฅุบูุงู</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="delete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title">ุชุฃููุฏ ุงูุญุฐู</h3>
            <p class="modal-description">ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ูุฐุง ุงูุชุฐููุฑุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐู ุงูุฎุทูุฉ.</p>
            <div class="modal-footer">
                <button id="cancel-delete" class="btn btn-outline">ุฅูุบุงุก</button>
                <button id="confirm-delete" class="btn btn-primary"
                    style="background-color: hsl(var(--destructive));">ุญุฐู</button>
            </div>
        </div>
    </div>

    <div id="alert-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="alert-title" class="modal-title">ุชูุจูู</h3>
            <p id="alert-message" class="modal-description"></p>
            <div class="modal-footer">
                <button id="alert-ok" class="btn btn-primary">ููุงูู</button>
            </div>
        </div>
    </div>



    <!-- App Logic Initialization -->
    <script>
        // Environmental Check
        const isCapacitor = !!window.Capacitor && window.Capacitor.getPlatform() !== 'web';
        if (isCapacitor) {
            document.body.classList.add('is-app');
            // Enable legacy styles for the app
            document.getElementById('legacy-styles').disabled = false;
            // Show app container immediately on native
            const app = document.getElementById('app-container');
            if (app) app.style.display = 'flex';
        } else {
            // On web, ensure legacy styles are disabled to prevent conflicts
            document.getElementById('legacy-styles').disabled = true;
        }
    </script>
    
    <!-- React Entry (Landing Page) -->
    <script src="app/main.tsx" type="module"></script>
    
    <!-- Extension Logic (Android App / Browser Popup) -->
    <script src="app.js" type="module"></script>

    <!-- SW Registration (Web only) -->
    <script>
        if (!isCapacitor && 'serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(err => console.log('Service Worker NOT registered', err));
            });
        }
    </script>
</body>

</html>